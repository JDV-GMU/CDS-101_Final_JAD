---
title: "Coding"
output: html_document
---
# Set up
```{r setup}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(boot))
```
```{r}
diamonds <- readr::read_csv("data/sample_data.csv")
```
# cleaning data, only getting the needed values
```{r}
diamond_1 <- diamonds %>%
  select(carat, cut, clarity, price) %>%
  mutate(
    cut_n = as.numeric(factor(
      cut,
      levels = c("Fair", "Good", "Very Good", "Premium", "Ideal")
    )
  ),
    clarity_n = as.numeric(factor(
      clarity,
      levels = c("I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF")
    ))
  )
```
# Clarity and cut vs prices point plots
```{r, fig.width = 7}
diamond_1 %>%
  pivot_longer(cols = cut_n|clarity_n|carat,
               names_to = "measurement",
               values_to = "value") %>%
  ggplot() +
    geom_bin2d(aes(x = value, y = price)) +
    scale_fill_viridis_c(trans = "log") +
    facet_wrap(~ measurement, scales = "free_x") +
  labs(title = "Cut and Clarity vs Price")
```
# Carat vs price heat plot
```{r}
diamond_1 %>%
  ggplot() +
  geom_bin2d(aes(x = carat, y = price)) +
  labs(
    title = "Carat vs. Price",
    x = "Carat",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log")
```
# Linear regression model for carat
```{r}
Diamond_model_a <- lm(price ~ carat, data = diamond_1)
```
```{r}
Diamond_model_a %>%
  tidy()
```
```{r}
Diamond_model_a %>%
  glance()
```
# Linear regression model for cut
```{r}
Diamond_model_u <- lm(price ~ cut_n, data = diamond_1)
```
```{r}
Diamond_model_u %>%
  tidy()
```
```{r}
Diamond_model_u %>%
  glance()
```
# Linear regression model for clarity
```{r}
Diamond_model_y <- lm(price ~ clarity_n, data = diamond_1)
```
```{r}
Diamond_model_y %>%
  tidy()
```
```{r}
Diamond_model_y %>%
  glance()
```
# graphing Carat vs price in relation to its Model
```{r}
diamond_ma_df <- diamond_1 %>%
  add_predictions(Diamond_model_a) %>%
  add_residuals(Diamond_model_a)
```
```{r}
diamond_ma_df
```
```{r}
ggplot(diamond_ma_df) +
  geom_bin2d(aes(x = price, y = carat)) +
  labs(
    title = "Carat vs. Price",
    x = "Price",
    y = "Carat"
  ) + 
scale_fill_viridis_c(trans = "log") +
  geom_abline(slope = Diamond_model_a$coefficients[2], intercept = Diamond_model_a$coefficients[1])
```
# graphing cut vs price in relation to its Model
```{r}
diamond_mu_df <- diamond_1 %>%
  add_predictions(Diamond_model_u) %>%
  add_residuals(Diamond_model_u)
```
```{r}
diamond_mu_df
```
```{r}
ggplot(diamond_mu_df) +
  geom_point(mapping = aes(x = price, y = cut)) +
  geom_abline(slope = Diamond_model_u$coefficients[2], intercept = Diamond_model_u$coefficients[1])
```
# graphing clarity vs price in relation to its Model
```{r}
diamond_my_df <- diamond_1 %>%
  add_predictions(Diamond_model_y) %>%
  add_residuals(Diamond_model_y)
```
```{r}
diamond_my_df
```
```{r}
ggplot(diamond_my_df) +
  geom_point(mapping = aes(x = price, y = clarity)) +
  geom_abline(slope = Diamond_model_y$coefficients[2], intercept = Diamond_model_y$coefficients[1])
```

```{r}
diamond_ma_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model A")
```
```{r}
diamond_mu_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model U")
```
```{r}
diamond_my_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model Y")
```
Model for Carat is Skewed left in total, but there is a spike at 0, Cut and clarity are skewed right.

Carat seems to have a higher correlation with Price in comparison to Clarity and Cut.

Source: https://www.vrai.com/journal/post/diamond-carat-price
article by Alicia Briggs | February 06, 2023


"Does The Carat Of A Diamond Affect The Price?
Carat weight is a significant factor in determining the total price of a diamond, but itâ€™s not the only one. The price of a diamond exponentially rises after 1 carat, with a 2 carat diamond often more than double the cost. Why? Because the higher the carat weight, the bigger the loose diamond it was cut from. This means the diamond is rarer and therefore more valuable."
```{r}
diamond_2 <- diamond_1 %>%
  mutate(cut_numeric = as.numeric(factor(cut)),
         clarity_numeric = as.numeric(factor(clarity)))
```


