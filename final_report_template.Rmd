---
title: "CDS 101 – Final Project Report"
author: "JAD - John D Villanuela, Akshaya Pabbisetty, David Brown"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
  pdf_document:
    toc: true
editor_options: 
  markdown: 
    wrap: 72
---

> Replace this template text with your own writing, keeping the headings
> and overall structure aligned with the **CDS 101 project rubric**.

# 1. Problem Definition

We are going to be investigating a variety of factors that may affect
the price of a diamond. Diamonds are highly sought-after gems, used in
all sorts of precious jewelry. With a dataset containing information on
many aspects of diamonds, we will determine the particular effects of
the clarity, carats, and cut quality of any diamond upon its price. We
believe that the clarity and carat of a diamond will be strong
predictors of pricing while the cut quality will be a weaker predictor.

# 2. Data Acquisition & Description

The dataset is, quite simply, called "diamonds". It was obtained from
the website Kaggle at the link
<https://www.kaggle.com/datasets/ayeshaseherr/diamonds>.

There are ten variables creating each column; three are categorical,
these being the cut quality, color grade, and clarity rating. The
remaining seven are carat, depth, table, x, y, z, and price.

The variables x, y, and z are the length, width, and depth in
millimeters, carats are a measure of diamond weight, table is the top
width percentage of each diamond, and price is standardly measured in
USD.

There are just under 54000 entries/rows in the dataset, making it very
large overall.

```{r setup-data, echo=FALSE, message=FALSE, warning=FALSE}
library(readr)
diamond_df <- read_csv("data/diamonds.csv")
```

# 3. Data Cleaning & Preprocessing

Describe the steps you took to make the data usable, for example:

-   Handling missing values (drop, impute, etc.).\
-   Fixing types (dates, numeric vs. categorical).\
-   Removing outliers (if done).\
-   Creating new features (feature engineering).\
-   Any scaling or encoding.

```{r cleaning, eval=FALSE}
# Example pseudo-code for cleaning:
# data_clean <- data |>
#   dplyr::filter(!is.na(target_variable)) |>
#   dplyr::mutate(
#     new_feature = some_transformation(old_feature)
#   )

diamond_1 <- diamonds %>%
  select(carat, cut, clarity, price)
```

# 4. Exploratory Data Analysis (EDA)

This section maps directly to the **EDA** part of the rubric:


```{r eda-summary, message=FALSE, warning=FALSE}
# library(dplyr)
# summary(data_clean)
Diamond_model_a <- lm(price ~ carat, data = diamond_1)
Diamond_model_a %>%
  glance()

Diamond_model_u <- lm(price ~ cut, data = diamond_1)
Diamond_model_u %>%
  glance()

Diamond_model_y <- lm(price ~ clarity, data = diamond_1)
Diamond_model_y %>%
  glance()
```

When glancing at each model, the squared residual for the Carat Model is much closer to one in comparison to Cut's model and Clarity's model.

```{r eda-plot-example, message=FALSE, warning=FALSE, fig.cap="Example histogram of a numeric variable (EDA rubric)."}
# library(ggplot2)
# ggplot(data_clean, aes(x = some_numeric_variable)) +
#   geom_histogram(binwidth = 5, color = "white") +
#   labs(x = "Some Variable", y = "Count", title = "Distribution of Some Variable")
```

# 5. Visualization Quality and Storytelling

Use this section to satisfy the **Visualization Quality** rubric
criterion:

-   Explain why your plot types are appropriate.

We used a heat map to visualize the relationship and the density of
weight in Carats in comparison to the price of a diamond. Due to the
quantity of entries, there is a high density that would not be able to
be explored efficiently with a point plot. The heat map shows the points
with a higher density of diamonds and lesser density of diamonds without
getting muddled.

-   Comment on labels, legends, colors, and overall readability.

The heatmaps show the density in different colors, making it more
readable and understandable of the relationship. All graphs are labeled
with accurate titles and labels.

-   Mention any steps you took to make plots accessible and
    interpretable.
    
We chose to utilize a heat map instead of a normal point plot to make it more interpretable and accessible due to the sheer amount of entries.

```{r, fig.width = 7}
diamond_1 %>%
  pivot_longer(cols = cut:clarity,
               names_to = "measurement",
               values_to = "value") %>%
  ggplot() +
  geom_boxplot(aes(x = value, y = price)) +
  facet_wrap(~ measurement, scales = "free_x") +
  labs(title = "Clarity and Cut vs Price") +
  theme(axis.text.x = element_text(angle = 55))
```
```{r}
diamond_1 %>%
  ggplot() +
  geom_bin2d(aes(x = carat, y = price)) +
  labs(
    title = "Carat vs. Price",
    x = "Carat",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log")
```

# 6. Modeling Approach

Explain how you framed the problem and which models you chose:

-   Type of task (regression, classification, etc.).\
Basic linear regression model.
-   Main model(s) chosen and why they are appropriate.

# 7. Model Implementation & Evaluation

This corresponds to the **Model Implementation & Evaluation** rubric
criterion.

Describe:

-   Features used.\
-   Data splitting strategy (train/test or cross-validation).\
-   Metrics used (accuracy, F1, RMSE, etc.).\
-   Tables/plots summarizing performance.\
-   A short interpretation of each metric/plot.

```{r modeling, eval=FALSE}
# Example structure:
# set.seed(123)
# train_index <- sample(seq_len(nrow(data_clean)), size = 0.8 * nrow(data_clean))
# train <- data_clean[train_index, ]
# test  <- data_clean[-train_index, ]
#
# model <- glm(target ~ ., data = train, family = binomial)
# preds <- predict(model, newdata = test, type = "response")
# # compute metrics...

diamond_ma_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Carat Model")

diamond_mu_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Cut Model")

diamond_my_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Clarity Model")

```
Model for Carat is Skewed left in total, but there is a higher spike at 0, where as Cut and clarity are skewed right.


# 8. Conclusions & Recommendations

Summarize the key takeaways:

-   Carat seems to have a higher correlation with Price in comparison to Clarity and Cut.
-   Carat's squared residuals indicated a much higher correlation with the Pricing of a diamond sold.
-   This is nearly 54 thousand entries with the price range approximatly 18497 dollars in length.
-   To quote an article by Alicia Briggs from Vrai, "Carat weight is a significant factor in determining the total price of a diamond, but it’s not the only one. The price of a diamond exponentially rises after 1 carat, with a 2 carat diamond often more than double the cost. Why? Because the higher the carat weight, the bigger the loose diamond it was cut from. This means the diamond is rarer and therefore more valuable."

# 9. Code Quality & Reproducibility

Briefly document how someone else can reproduce your results:

```{r session-info, echo=FALSE}
sessionInfo()
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
diamonds <- readr::read_csv("data/sample_data.csv")
```
```{r setup}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
diamonds <- readr::read_csv("data/sample_data.csv")
```
# cleaning data, only getting the needed values
```{r}
diamond_1 <- diamonds %>%
  select(carat, cut, clarity, price)
```
# Clarity and cut vs prices point plots
```{r, fig.width = 8}
diamond_1 %>%
  pivot_longer(cols = cut:clarity,
               names_to = "measurement",
               values_to = "value") %>%
  ggplot() +
    geom_bin2d(aes(x = value, y = price)) +
    scale_fill_viridis_c(trans = "log") +
    facet_wrap(~ measurement, scales = "free_x")
```
# Carat vs price heat plot
```{r}

diamond_1 %>%
  ggplot() +
  geom_bin2d(aes(x = carat, y = price)) +
  labs(
    title = "Carat vs. Price",
    x = "Carat",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log")
```
# Linear regression model for carat
```{r}
Diamond_model_a <- lm(price ~ carat, data = diamond_1)
```
```{r}
Diamond_model_a %>%
  tidy()
```
```{r}
Diamond_model_a %>%
  glance()
```
# Linear regression model for cut
```{r}
Diamond_model_u <- lm(price ~ cut, data = diamond_1)
```
```{r}
Diamond_model_u %>%
  tidy()
```
```{r}
Diamond_model_u %>%
  glance()
```
# Linear regression model for clarity
```{r}
Diamond_model_y <- lm(price ~ clarity, data = diamond_1)
```
```{r}
Diamond_model_y %>%
  tidy()
```
```{r}
Diamond_model_y %>%
  glance()
```
# graphing Carat vs price in relation to its Model
```{r}
diamond_ma_df <- diamonds %>%
  add_predictions(Diamond_model_a) %>%
  add_residuals(Diamond_model_a)
```
```{r}
diamond_ma_df
```
```{r}
ggplot(diamond_ma_df) +
  geom_bin2d(aes(x = price, y = carat)) +
  labs(
    title = "Carat vs. Price",
    x = "Price",
    y = "Carat"
  ) + 
scale_fill_viridis_c(trans = "log") +
  geom_abline(slope = Diamond_model_a$coefficients[2], intercept = Diamond_model_a$coefficients[1])
```
# graphing cut vs price in relation to its Model
```{r}
diamond_mu_df <- diamonds %>%
  add_predictions(Diamond_model_u) %>%
  add_residuals(Diamond_model_u)
```
```{r}
diamond_mu_df
```
```{r}
ggplot(diamond_mu_df) +
  geom_point(mapping = aes(x = price, y = cut)) +
  geom_abline(slope = Diamond_model_u$coefficients[2], intercept = Diamond_model_u$coefficients[1])
```
# graphing clarity vs price in relation to its Model
```{r}
diamond_my_df <- diamonds %>%
  add_predictions(Diamond_model_y) %>%
  add_residuals(Diamond_model_y)
```
```{r}
diamond_my_df
```
```{r}
ggplot(diamond_my_df) +
  geom_point(mapping = aes(x = price, y = clarity)) +
  geom_abline(slope = Diamond_model_y$coefficients[2], intercept = Diamond_model_y$coefficients[1])
```
# residual histogram plots of all 3 models.
```{r}
diamond_ma_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model A")
```
```{r}
diamond_mu_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model U")
```
```{r}
diamond_my_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model Y")
```

# 10. References

List any references you used, such as:

<https://www.vrai.com/journal/post/diamond-carat-price> article by
Alicia Briggs \| February 06, 2023

<https://www.kaggle.com/datasets/ayeshaseherr/diamonds>.

# Appendix (Optional)

Include extra plots, diagnostic checks, or model comparisons if needed.
