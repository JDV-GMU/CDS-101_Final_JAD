---
title: "CDS 101 – Final Project Report"
author: "JAD - John D Villanueva, Akshaya Pabbisetty, David Brown"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
  pdf_document:
    toc: true
editor_options: 
  markdown: 
    wrap: 72
---


# 1. Problem Definition

We are going to be investigating a variety of factors that may affect
the price of a diamond. Diamonds are highly sought-after gems, used in
all sorts of precious jewelry. With a dataset containing information on
many aspects of diamonds, we will determine the particular effects of
the clarity, weight in carats, and the cut quality of any diamond upon its price. We
believe that the clarity and carat of a diamond will be strong
predictors of pricing while the cut quality will be a weaker predictor.

# 2. Data Acquisition & Description

The dataset is, quite simply, called "diamonds". It was obtained from
the website Kaggle at the link
<https://www.kaggle.com/datasets/ayeshaseherr/diamonds>.

There are ten variables creating each column; three are categorical,
these being the cut quality, color grade, and clarity rating. The
remaining seven are carat, depth, table, x, y, z, and price.

The variables x, y, and z are the length, width, and depth in
millimeters, carats are a measure of diamond weight, table is the top
width percentage of each diamond, and price is standardly measured in
USD.

There are just under 54000 entries/rows in the dataset, making it very
large overall.

```{r setup-data}
library(readr)
diamond_df <- read_csv("data/diamonds.csv")
```

# 3. Data Cleaning & Preprocessing

```{r cleaning}
library(tidyverse)
diamond_1 <- diamonds %>%
  select(carat, cut, clarity, price) %>%
  mutate(
    cut_n = as.numeric(factor(
      cut,
      levels = c("Fair", "Good", "Very Good", "Premium", "Ideal")
    )
  ),
    clarity_n = as.numeric(factor(
      clarity,
      levels = c("I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF")
    ))
  )
```
Cut and Clarity do need to be changed into numeric values with as.numeric(factor()), and I have used levels = c() to make sure that each category is properly organized in ascending quality.

# 4. Exploratory Data Analysis (EDA)

```{r eda-summary, message=FALSE, warning=FALSE}
library(broom)
library(tidyverse)
library(modelr)
Diamond_model_a <- lm(price ~ carat, data = diamond_1)
Diamond_model_a %>%
  glance()

Diamond_model_u <- lm(price ~ cut_n, data = diamond_1)
Diamond_model_u %>%
  glance()

Diamond_model_y <- lm(price ~ clarity_n, data = diamond_1)
Diamond_model_y %>%
  glance()

diamond_ma_df <- diamond_1 %>%
  add_predictions(Diamond_model_a) %>%
  add_residuals(Diamond_model_a)
diamond_mu_df <- diamond_1 %>%
  add_predictions(Diamond_model_u) %>%
  add_residuals(Diamond_model_u)
diamond_my_df <- diamond_1 %>%
  add_predictions(Diamond_model_y) %>%
  add_residuals(Diamond_model_y)
```

When glancing at each model, the squared residual for the Carat Model is much closer to one in comparison to Cut's model and Clarity's model. As well as the creation of the dataframes of said models.

```{r}
diamond_2 <- diamond_1 %>%
  mutate(
    Weight_com_Clar = clarity_n / carat,
    Weight_com_Cut = cut_n / carat
  )
```
```{r}
Diamond_model_au <- lm(price ~ Weight_com_Cut, data = diamond_2)
```
```{r}
Diamond_model_au %>%
  tidy()
```
```{r}
Diamond_model_au %>%
  glance()
```

```{r}
Diamond_model_ay <- lm(price ~ Weight_com_Clar, data = diamond_2)
```
```{r}
Diamond_model_ay %>%
  tidy()
```
```{r}
Diamond_model_ay %>%
  glance()
```
```{r}
diamond_may_df <- diamond_2 %>%
  add_predictions(Diamond_model_ay) %>%
  add_residuals(Diamond_model_ay)

diamond_mau_df <- diamond_2 %>%
  add_predictions(Diamond_model_au) %>%
  add_residuals(Diamond_model_au)
```

```{r}
diamond_mau_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model A and U")
```
```{r}
diamond_may_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model A and Y")
```

To further conclude a hierarchy of influence, we did see how Carat and Clarity compares to Weight and Cut as their own variables. The results do show the a Cut of a diamond has a greater influence over Clarity, with Weight_com_Cut's squared residuals being closer to 1.

# 5. Visualization Quality and Storytelling

-   Explain why your plot types are appropriate.

We used a heat map to visualize the relationship and the density of
weight in Carats in comparison to the price of a diamond. Due to the
quantity of entries, there is a high density that would not be able to
be explored efficiently with a point plot. The heat map shows the points
with a higher density of diamonds and lesser density of diamonds without
getting muddled.

-   Comment on labels, legends, colors, and overall readability.

The heatmaps show the density in different colors, making it more
readable and understandable of the relationship. All graphs are labeled
with accurate titles and labels.

-   Mention any steps you took to make plots accessible and
    interpretable.
    
We chose to utilize a heat map instead of a normal point plot to make it more interpretable and accessible due to the sheer amount of entries.

```{r, fig.width = 7, out.width = "100%"}
diamond_1 %>%
  pivot_longer(cols = cut_n|clarity_n|carat,
               names_to = "measurement",
               values_to = "value") %>%
  ggplot() +
  geom_bin2d(aes(x = value, y = price)) +
  labs(
    title = "Clarity and Cut vs. Price",
    x = "values",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log") +
  facet_wrap(~ measurement, scales = "free_x") +
  labs(title = "Clarity and Cut vs Price")
```
```{r}
diamond_1 %>%
  ggplot() +
  geom_bin2d(aes(x = carat, y = price)) +
  labs(
    title = "Carat vs. Price",
    x = "Carat",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log")
```

# 6. Modeling Approach

Explain how you framed the problem and which models you chose:

-   Type of task (regression, classification, etc.).

A basic linear regression model was used as it was the most appropriate model
to use as our research question was looking at the correlation between three
variables and which one affected the pricing of diamonds the most among all
entries, and a linear regression model was the most convenient method to do so.

-   Main model(s) chosen and why they are appropriate.

The main models we used were the box plots and the heat maps (2d bin plots). 
The box plots were used on the cut and clarity predictors due to them being 
categorical, and the heat maps were used with the carat predictor since it 
is a continuous predictor.

# 7. Model Implementation & Evaluation

```{r modeling}
diamond_ma_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Carat Model")
diamond_mu_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Cut Model")
diamond_my_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Clarity Model")
```
Model for Carat is Skewed left in total, but there is a higher spike at 0, where as Cut and clarity are skewed right.


# 8. Conclusions & Recommendations

Carat seems to have a higher correlation with the Price of a diamond in comparison to Clarity and Cut because of the feature's squared residuals being very close to 1. Since this dataset has nearly 54 thousand entries with the price range approximately 18497 dollars, the sheer amount of data does hinder some comprehension. So taking some smaller sample of the data would help with comprehension. To quote an article by Alicia Briggs from Vrai, in relation to the reasoning behind carat's influence, "Carat weight is a significant factor in determining the total price of a diamond, but it’s not the only one. The price of a diamond exponentially rises after 1 carat, with a 2 carat diamond often more than double the cost. Why? Because the higher the carat weight, the bigger the loose diamond it was cut from. This means the diamond is rarer and therefore more valuable."

# 9. Code Quality & Reproducibility

Briefly document how someone else can reproduce your results:

## Set up.
```{r session-info, echo=FALSE}
sessionInfo()
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(modelr))
diamonds <- readr::read_csv("data/sample_data.csv")
```

## Cleaning data, only getting the needed values
```{r}
diamond_1 <- diamonds %>%
  select(carat, cut, clarity, price) %>%
  mutate(
    cut_n = as.numeric(factor(
      cut,
      levels = c("Fair", "Good", "Very Good", "Premium", "Ideal")
    )
  ),
    clarity_n = as.numeric(factor(
      clarity,
      levels = c("I1", "SI2", "SI1", "VS2", "VS1", "VVS2", "VVS1", "IF")
    ))
  )
```

## Clarity and cut vs prices point plots
```{r, fig.width = 8}
diamond_1 %>%
  pivot_longer(cols = cut_n:clarity_n,
               names_to = "measurement",
               values_to = "value") %>%
  ggplot() +
    geom_bin2d(aes(x = value, y = price)) +
    scale_fill_viridis_c(trans = "log") +
    facet_wrap(~ measurement, scales = "free_x")
```

## Carat vs price heat plot
```{r}

diamond_1 %>%
  ggplot() +
  geom_bin2d(aes(x = carat, y = price)) +
  labs(
    title = "Carat vs. Price",
    x = "Carat",
    y = "Price"
  ) + 
scale_fill_viridis_c(trans = "log")
```

## Linear regression model for carat
```{r}
Diamond_model_a <- lm(price ~ carat, data = diamond_1)
```
```{r}
Diamond_model_a %>%
  tidy()
```
```{r}
Diamond_model_a %>%
  glance()
```

## Linear regression model for cut
```{r}
Diamond_model_u <- lm(price ~ cut_n, data = diamond_1)
```
```{r}
Diamond_model_u %>%
  tidy()
```
```{r}
Diamond_model_u %>%
  glance()
```

## Linear regression model for clarity
```{r}
Diamond_model_y <- lm(price ~ clarity_n, data = diamond_1)
```
```{r}
Diamond_model_y %>%
  tidy()
```
```{r}
Diamond_model_y %>%
  glance()
```

## Graphing Carat vs price in relation to its Model
```{r}
diamond_ma_df <- diamond_1 %>%
  add_predictions(Diamond_model_a) %>%
  add_residuals(Diamond_model_a)
```
```{r}
diamond_ma_df
```
```{r}
ggplot(diamond_ma_df) +
  geom_bin2d(aes(x = price, y = carat)) +
  labs(
    title = "Carat vs. Price",
    x = "Price",
    y = "Carat"
  ) + 
scale_fill_viridis_c(trans = "log") +
  geom_abline(slope = Diamond_model_a$coefficients[2], intercept = Diamond_model_a$coefficients[1])
```

## Graphing cut vs price in relation to its Model
```{r}
diamond_mu_df <- diamond_1 %>%
  add_predictions(Diamond_model_u) %>%
  add_residuals(Diamond_model_u)
```
```{r}
diamond_mu_df
```
```{r}
ggplot(diamond_mu_df) +
  geom_point(mapping = aes(x = price, y = cut)) +
  geom_abline(slope = Diamond_model_u$coefficients[2], intercept = Diamond_model_u$coefficients[1])
```

## Graphing clarity vs price in relation to its Model
```{r}
diamond_my_df <- diamond_1 %>%
  add_predictions(Diamond_model_y) %>%
  add_residuals(Diamond_model_y)
```
```{r}
diamond_my_df
```
```{r}
ggplot(diamond_my_df) +
  geom_point(mapping = aes(x = price, y = clarity)) +
  geom_abline(slope = Diamond_model_y$coefficients[2], intercept = Diamond_model_y$coefficients[1])
```

## Residual histogram plots of all 3 models.
```{r}
diamond_ma_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model A")
```
```{r}
diamond_mu_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model U")
```
```{r}
diamond_my_df %>%
  ggplot()+
  geom_histogram(mapping = aes(x = resid), bins = 20) +
  labs(title = "Residuals of Model Y")
```

# 10. References

References:

<https://www.vrai.com/journal/post/diamond-carat-price> article by
Alicia Briggs \| February 06, 2023

<https://www.kaggle.com/datasets/ayeshaseherr/diamonds>.
